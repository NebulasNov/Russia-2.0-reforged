#Troubleshooting
on_actions = {
    on_startup = {
        effect = {
            set_global_flag = russia_reworked_enabled

            set_variable = { global.russia_reworked_core_file_missing = 0 }
            set_variable = { global.russia_reworked_noncore_file_missing = 0 }

            add_to_array = { global.russia_reworked_countries_load = AFF }
            add_to_array = { global.russia_reworked_countries_load = AIN }
            add_to_array = { global.russia_reworked_countries_load = ANT }
            add_to_array = { global.russia_reworked_countries_load = ARM }
            add_to_array = { global.russia_reworked_countries_load = ASR }
            add_to_array = { global.russia_reworked_countries_load = ASY }
            add_to_array = { global.russia_reworked_countries_load = AZR }
            add_to_array = { global.russia_reworked_countries_load = BAB }
            add_to_array = { global.russia_reworked_countries_load = BLR }
            add_to_array = { global.russia_reworked_countries_load = BRN }
            add_to_array = { global.russia_reworked_countries_load = BRP }
            add_to_array = { global.russia_reworked_countries_load = CAA }
            add_to_array = { global.russia_reworked_countries_load = CAF }
            add_to_array = { global.russia_reworked_countries_load = CAI }
            add_to_array = { global.russia_reworked_countries_load = CFR }
            add_to_array = { global.russia_reworked_countries_load = CIR }
            add_to_array = { global.russia_reworked_countries_load = CLG }
            add_to_array = { global.russia_reworked_countries_load = CRI }
            add_to_array = { global.russia_reworked_countries_load = DAG }
            add_to_array = { global.russia_reworked_countries_load = EAR }
            add_to_array = { global.russia_reworked_countries_load = EFR }
            add_to_array = { global.russia_reworked_countries_load = EUR }
            add_to_array = { global.russia_reworked_countries_load = FAT }
            add_to_array = { global.russia_reworked_countries_load = FSZ }
            add_to_array = { global.russia_reworked_countries_load = GEO }
            add_to_array = { global.russia_reworked_countries_load = GPM }
            add_to_array = { global.russia_reworked_countries_load = HEJ }
            add_to_array = { global.russia_reworked_countries_load = HES }
            add_to_array = { global.russia_reworked_countries_load = HIT }
            add_to_array = { global.russia_reworked_countries_load = HOS }
            add_to_array = { global.russia_reworked_countries_load = KAL }
            add_to_array = { global.russia_reworked_countries_load = KAR }
            add_to_array = { global.russia_reworked_countries_load = KAZ }
            add_to_array = { global.russia_reworked_countries_load = KMI }
            add_to_array = { global.russia_reworked_countries_load = KUB }
            add_to_array = { global.russia_reworked_countries_load = KUR }
            add_to_array = { global.russia_reworked_countries_load = KYR }
            add_to_array = { global.russia_reworked_countries_load = MDE }
            add_to_array = { global.russia_reworked_countries_load = MED }
            add_to_array = { global.russia_reworked_countries_load = MEF }
            add_to_array = { global.russia_reworked_countries_load = MES }
            add_to_array = { global.russia_reworked_countries_load = MOI }
            add_to_array = { global.russia_reworked_countries_load = NAF }
            add_to_array = { global.russia_reworked_countries_load = NEJ }
            add_to_array = { global.russia_reworked_countries_load = NOV }
            add_to_array = { global.russia_reworked_countries_load = OCE }
            add_to_array = { global.russia_reworked_countries_load = ODA }
            add_to_array = { global.russia_reworked_countries_load = POM }
            add_to_array = { global.russia_reworked_countries_load = PRM }
            add_to_array = { global.russia_reworked_countries_load = PRT }
            add_to_array = { global.russia_reworked_countries_load = RAS }
            add_to_array = { global.russia_reworked_countries_load = RHI }
            add_to_array = { global.russia_reworked_countries_load = ROS }
            add_to_array = { global.russia_reworked_countries_load = RYU }
            add_to_array = { global.russia_reworked_countries_load = SAR }
            add_to_array = { global.russia_reworked_countries_load = SEA }
            add_to_array = { global.russia_reworked_countries_load = SFR }
            add_to_array = { global.russia_reworked_countries_load = SHB }
            add_to_array = { global.russia_reworked_countries_load = SHI }
            add_to_array = { global.russia_reworked_countries_load = SIB }
            add_to_array = { global.russia_reworked_countries_load = SIL }
            add_to_array = { global.russia_reworked_countries_load = SOU }
            add_to_array = { global.russia_reworked_countries_load = SOV }
            add_to_array = { global.russia_reworked_countries_load = STP }
            add_to_array = { global.russia_reworked_countries_load = TAJ }
            add_to_array = { global.russia_reworked_countries_load = TAT }
            add_to_array = { global.russia_reworked_countries_load = TEU }
            add_to_array = { global.russia_reworked_countries_load = THU }
            add_to_array = { global.russia_reworked_countries_load = TMS }
            add_to_array = { global.russia_reworked_countries_load = TOK }
            add_to_array = { global.russia_reworked_countries_load = TRE }
            add_to_array = { global.russia_reworked_countries_load = UES }
            add_to_array = { global.russia_reworked_countries_load = UKR }
            add_to_array = { global.russia_reworked_countries_load = URA }
            add_to_array = { global.russia_reworked_countries_load = UZB }
            add_to_array = { global.russia_reworked_countries_load = VLG }
            add_to_array = { global.russia_reworked_countries_load = VYA }
            add_to_array = { global.russia_reworked_countries_load = TAN }

            #Focus Trees
            if = {
                limit = {
                    all_of_scopes = {
                        array = global.russia_reworked_soviets
                        
                        has_focus_tree = russia2_soviet_focus
                    }
                }
                set_global_flag = russia_reworked_focus_loaded_sov
            }
            else = {
                for_each_scope_loop = {
                    array = global.russia_reworked_soviets
                    break = break_loop

                    if = {
                        limit = {
                            NOT = {
                                has_focus_tree = russia2_soviet_focus
                            }
                        }
                        set_country_flag = russia_rework_focus_missing_sov
                        add_to_variable = { global.russia_reworked_core_file_missing = 1 }
                    }
                }
            }

            if = {
                limit = {
                    UKR = {
                        has_focus_tree = russia2_ukraine_focus
                    }
                }
                set_global_flag = russia_reworked_focus_loaded_ukr
            }
            else = {
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    all_of_scopes = {
                        array = global.russia_reworked_continents
                        
                        has_focus_tree = continents_focus
                    }
                }
                set_global_flag = russia_reworked_focus_loaded_con
            }
            else = {
                for_each_scope_loop = {
                    array = global.russia_reworked_continents
                    break = break_loop

                    if = {
                        limit = {
                            NOT = {
                                has_focus_tree = continents_focus
                            }
                        }
                        set_country_flag = russia_rework_focus_missing_con
                        add_to_variable = { global.russia_reworked_core_file_missing = 1 }
                    }
                }
            }

            #Decisions (doesn't work)
            # if = {
            #     limit = {
            #         SOV = {
            #             has_decision = SOV_russia_reworked_load_decision_russia2
            #         }
            #     }
            #     set_global_flag = russia_reworked_decision_loaded_russia2
            # }
            # else = {
            #     add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            # }

            # if = {
            #     limit = {
            #         SOV = {
            #             has_decision = SOV_russia_reworked_load_decision_soviet
            #         }
            #     }
            #     set_global_flag = russia_reworked_decision_loaded_soviet
            # }
            # else = {
            #     add_to_variable = { global.russia_reworked_noncore_file_missing = 1 }
            # }

            #Ideas
            SOV = {
                add_ideas = {
                    SOV_russia2_idea_load
                    soviet_idea_load
                }
            }

            if = {
                limit = {
                    NOT = {
                        SOV = {
                            has_idea = SOV_russia2_idea_load
                        }
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }
            if = {
                limit = {
                    NOT = {
                        SOV = {
                            has_idea = soviet_idea_load
                        }
                    }
                }
                add_to_variable = { global.russia_reworked_noncore_file_missing = 1 }
            }

            SOV = {
                remove_ideas = {
                    SOV_russia2_idea_load
                    soviet_idea_load
                }
            }

            #Events
            SOV = {
                country_event = baltic.2092066524
                country_event = baltics.2092066524
                country_event = bulgarias.2092066524
                country_event = chinas.2092066524
                country_event = wtt_prcs.2092066524
                country_event = continents.2092066524
                country_event = englands.2092066524
                country_event = finland.2092066524
                country_event = finlands.2092066524
                country_event = frances.2092066524
                country_event = generics.2092066524
                country_event = germanys.2092066524
                country_event = italys.2092066524
                country_event = japans.2092066524
                country_event = manchukuos.2092066524
                country_event = mexico.2092066524
                country_event = mongolias.2092066524
                country_event = newsrussia2.2092066524
                country_event = polands.2092066524
                country_event = revolutions.2092066524
                country_event = romanias.2092066524
                country_event = soviet.2092066524
                country_event = soviets.2092066524
                country_event = spains.2092066524
                country_event = tannu.2092066524
                country_event = turkeys.2092066524
                country_event = ukrains.2092066524
                country_event = americas.2092066524
                country_event = yaltas.2092066524
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_baltic
                    }
                }
                add_to_variable = { global.russia_reworked_noncore_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_baltics
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_bulgarias
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_chinas
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_wtt_prcs
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_continents
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_englands
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_finland
                    }
                }
                add_to_variable = { global.russia_reworked_noncore_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_finlands
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_frances
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_generics
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_germanys
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_italys
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_japans
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_manchukuos
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_mexico
                    }
                }
                add_to_variable = { global.russia_reworked_noncore_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_mongolias
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_newsrussia2
                    }
                }
                add_to_variable = { global.russia_reworked_noncore_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_polands
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_revolutions
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_romanias
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_soviet
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_soviets
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_spains
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_tannu
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_turkeys
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_ukrains
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_americas
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_yaltas
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            #Countries
            for_each_loop = {
                array = global.russia_reworked_countries_load

                if = {
                    limit = {
                        NOT = {
                            is_in_array = {
                                array = global.russia_reworked_countries
                                value = var:v
                            }
                        }
                    }
                    add_to_variable = { global.russia_reworked_core_file_missing = 1 }
                    if = {
                        limit = {
                            is_in_array = {
                                array = global.countries
                                value = var:v
                            }
                        }
                        var:v = {
                            set_country_flag = russia_rework_country_missing
                        }
                    }
                }
            }

            if = {
                limit = {
                    check_variable = {
                        var = global.russia_reworked_core_file_missing
                        value = 1
                        compare = greater_than_or_equals
                    }
                }
                set_global_flag = russia_reworked_error
                log = "Russia Reworked : [?global.russia_reworked_core_file_missing] core files missing"
                log = "Russia Reworked : [?global.russia_reworked_noncore_file_missing] non core files missing"
            }
            else_if = {
                limit = {
                    check_variable = {
                        var = global.russia_reworked_noncore_file_missing
                        value = 1
                        compare = greater_than_or_equals
                    }
                }
                log = "Russia Reworked : [?global.russia_reworked_noncore_file_missing] non core files missing"
            }
            else = {
                log = "Russia Reworked : No error"
            }

            set_global_flag = russia_reworked_loaded
        }
    }
}