#Troubleshooting
on_actions = {
    on_startup = {
        effect = {
            set_global_flag = russia_reworked_enabled

            set_variable = { global.russia_reworked_core_file_missing = 0 }
            set_variable = { global.russia_reworked_noncore_file_missing = 0 }

            add_to_array = { global.russia_reworked_countries = AFF }
            add_to_array = { global.russia_reworked_countries = AIN }
            add_to_array = { global.russia_reworked_countries = ANT }
            add_to_array = { global.russia_reworked_countries = ARM }
            add_to_array = { global.russia_reworked_countries = ASR }
            add_to_array = { global.russia_reworked_countries = ASY }
            add_to_array = { global.russia_reworked_countries = AZR }
            add_to_array = { global.russia_reworked_countries = BAB }
            add_to_array = { global.russia_reworked_countries = BLR }
            add_to_array = { global.russia_reworked_countries = BRN }
            add_to_array = { global.russia_reworked_countries = BRP }
            add_to_array = { global.russia_reworked_countries = CAA }
            add_to_array = { global.russia_reworked_countries = CAF }
            add_to_array = { global.russia_reworked_countries = CAI }
            add_to_array = { global.russia_reworked_countries = CIR }
            add_to_array = { global.russia_reworked_countries = CLG }
            add_to_array = { global.russia_reworked_countries = CRI }
            add_to_array = { global.russia_reworked_countries = DAG }
            add_to_array = { global.russia_reworked_countries = EAR }
            add_to_array = { global.russia_reworked_countries = EFR }
            add_to_array = { global.russia_reworked_countries = EUR }
            add_to_array = { global.russia_reworked_countries = FAT }
            add_to_array = { global.russia_reworked_countries = FSZ }
            add_to_array = { global.russia_reworked_countries = GEO }
            add_to_array = { global.russia_reworked_countries = GPM }
            add_to_array = { global.russia_reworked_countries = HEJ }
            add_to_array = { global.russia_reworked_countries = HES }
            add_to_array = { global.russia_reworked_countries = HIT }
            add_to_array = { global.russia_reworked_countries = HOS }
            add_to_array = { global.russia_reworked_countries = KAL }
            add_to_array = { global.russia_reworked_countries = KAR }
            add_to_array = { global.russia_reworked_countries = KAZ }
            add_to_array = { global.russia_reworked_countries = KMI }
            add_to_array = { global.russia_reworked_countries = KUB }
            add_to_array = { global.russia_reworked_countries = KYR }
            add_to_array = { global.russia_reworked_countries = MDE }
            add_to_array = { global.russia_reworked_countries = MED }
            add_to_array = { global.russia_reworked_countries = MEF }
            add_to_array = { global.russia_reworked_countries = MES }
            add_to_array = { global.russia_reworked_countries = MOI }
            add_to_array = { global.russia_reworked_countries = NAF }
            add_to_array = { global.russia_reworked_countries = NEJ }
            add_to_array = { global.russia_reworked_countries = NOV }
            add_to_array = { global.russia_reworked_countries = OCE }
            add_to_array = { global.russia_reworked_countries = ODA }
            add_to_array = { global.russia_reworked_countries = POM }
            add_to_array = { global.russia_reworked_countries = PRM }
            add_to_array = { global.russia_reworked_countries = RAS }
            add_to_array = { global.russia_reworked_countries = ROS }
            add_to_array = { global.russia_reworked_countries = RYU }
            add_to_array = { global.russia_reworked_countries = SAR }
            add_to_array = { global.russia_reworked_countries = SEA }
            add_to_array = { global.russia_reworked_countries = SFR }
            add_to_array = { global.russia_reworked_countries = SHB }
            add_to_array = { global.russia_reworked_countries = SHI }
            add_to_array = { global.russia_reworked_countries = SIB }
            add_to_array = { global.russia_reworked_countries = SIL }
            add_to_array = { global.russia_reworked_countries = SOU }
            add_to_array = { global.russia_reworked_countries = SOV }
            add_to_array = { global.russia_reworked_countries = STP }
            add_to_array = { global.russia_reworked_countries = TAJ }
            add_to_array = { global.russia_reworked_countries = TAT }
            add_to_array = { global.russia_reworked_countries = TEU }
            add_to_array = { global.russia_reworked_countries = THU }
            add_to_array = { global.russia_reworked_countries = TMS }
            add_to_array = { global.russia_reworked_countries = TOK }
            add_to_array = { global.russia_reworked_countries = TRE }
            add_to_array = { global.russia_reworked_countries = UES }
            add_to_array = { global.russia_reworked_countries = UKR }
            add_to_array = { global.russia_reworked_countries = URA }
            add_to_array = { global.russia_reworked_countries = UZB }
            add_to_array = { global.russia_reworked_countries = VLG }
            add_to_array = { global.russia_reworked_countries = VYA }

            add_to_array = { global.russia_reworked_soviets = SOV }
            add_to_array = { global.russia_reworked_soviets = SOU }

            add_to_array = { global.russia_reworked_continents = NAF }
            add_to_array = { global.russia_reworked_continents = CAF }
            add_to_array = { global.russia_reworked_continents = SAR }
            add_to_array = { global.russia_reworked_continents = CAI }
            add_to_array = { global.russia_reworked_continents = MEF }
            add_to_array = { global.russia_reworked_continents = AFF }
            add_to_array = { global.russia_reworked_continents = SFR }
            add_to_array = { global.russia_reworked_continents = SEA }
            add_to_array = { global.russia_reworked_continents = EAR }
            add_to_array = { global.russia_reworked_continents = OCE }
            add_to_array = { global.russia_reworked_continents = EUR }

            #Focus Trees
            if = {
                limit = {
                    all_of_scopes = {
                        array = global.russia_reworked_soviets
                        
                        has_focus_tree = russia2_soviet_focus
                    }
                }
                set_global_flag = russia_reworked_focus_loaded_sov
            }
            else = {
                for_each_scope_loop = {
                    array = global.russia_reworked_soviets
                    break = break_loop

                    if = {
                        limit = {
                            NOT = {
                                has_focus_tree = russia2_soviet_focus
                            }
                        }
                        set_country_flag = russia_rework_focus_missing_sov
                        add_to_variable = { global.russia_reworked_core_file_missing = 1 }
                    }
                }
            }

            if = {
                limit = {
                    UKR = {
                        has_focus_tree = russia2_ukraine_focus
                    }
                }
                set_global_flag = russia_reworked_focus_loaded_ukr
            }
            else = {
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    all_of_scopes = {
                        array = global.russia_reworked_continents
                        
                        has_focus_tree = continents_focus
                    }
                }
                set_global_flag = russia_reworked_focus_loaded_con
            }
            else = {
                for_each_scope_loop = {
                    array = global.russia_reworked_continents
                    break = break_loop

                    if = {
                        limit = {
                            NOT = {
                                has_focus_tree = continents_focus
                            }
                        }
                        set_country_flag = russia_rework_focus_missing_con
                        add_to_variable = { global.russia_reworked_core_file_missing = 1 }
                    }
                }
            }

            #Decisions (doesn't work)
            # if = {
            #     limit = {
            #         SOV = {
            #             has_decision = SOV_russia_reworked_load_decision_russia2
            #         }
            #     }
            #     set_global_flag = russia_reworked_decision_loaded_russia2
            # }
            # else = {
            #     add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            # }

            # if = {
            #     limit = {
            #         SOV = {
            #             has_decision = SOV_russia_reworked_load_decision_soviet
            #         }
            #     }
            #     set_global_flag = russia_reworked_decision_loaded_soviet
            # }
            # else = {
            #     add_to_variable = { global.russia_reworked_noncore_file_missing = 1 }
            # }

            #Ideas
            SOV = {
                add_ideas = {
                    SOV_russia2_idea_load
                    soviet_idea_load
                }
            }

            if = {
                limit = {
                    NOT = {
                        SOV = {
                            has_idea = SOV_russia2_idea_load
                        }
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }
            if = {
                limit = {
                    NOT = {
                        SOV = {
                            has_idea = soviet_idea_load
                        }
                    }
                }
                add_to_variable = { global.russia_reworked_noncore_file_missing = 1 }
            }

            SOV = {
                remove_ideas = {
                    SOV_russia2_idea_load
                    soviet_idea_load
                }
            }

            #Events
            SOV = {
                country_event = baltic.2092066524
                country_event = baltics.2092066524
                country_event = bulgarias.2092066524
                country_event = chinas.2092066524
                country_event = wtt_prcs.2092066524
                country_event = continents.2092066524
                country_event = englands.2092066524
                country_event = finland.2092066524
                country_event = finlands.2092066524
                country_event = frances.2092066524
                country_event = generics.2092066524
                country_event = germanys.2092066524
                country_event = italys.2092066524
                country_event = japans.2092066524
                country_event = manchukuos.2092066524
                country_event = mexico.2092066524
                country_event = mongolias.2092066524
                country_event = newsrussia2.2092066524
                country_event = polands.2092066524
                country_event = revolutions.2092066524
                country_event = romanias.2092066524
                country_event = soviet.2092066524
                country_event = soviets.2092066524
                country_event = spains.2092066524
                country_event = tannu.2092066524
                country_event = turkeys.2092066524
                country_event = ukrains.2092066524
                country_event = americas.2092066524
                country_event = yaltas.2092066524
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_baltic
                    }
                }
                add_to_variable = { global.russia_reworked_noncore_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_baltics
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_bulgarias
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_chinas
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_wtt_prcs
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_continents
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_englands
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_finland
                    }
                }
                add_to_variable = { global.russia_reworked_noncore_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_finlands
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_frances
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_generics
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_germanys
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_italys
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_japans
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_manchukuos
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_mexico
                    }
                }
                add_to_variable = { global.russia_reworked_noncore_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_mongolias
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_newsrussia2
                    }
                }
                add_to_variable = { global.russia_reworked_noncore_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_polands
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_revolutions
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_romanias
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_soviet
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_soviets
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_spains
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_tannu
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_turkeys
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_ukrains
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_americas
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            if = {
                limit = {
                    NOT = {
                        has_global_flag = russia_reworked_events_loaded_yaltas
                    }
                }
                add_to_variable = { global.russia_reworked_core_file_missing = 1 }
            }

            #Countries
            if = {
                limit = {
                    all_of_scopes = {
                        array = global.russia_reworked_countries
                        
                        has_country_flag = russia_reworked_country_loaded
                    }
                }
                set_global_flag = russia_reworked_countries_loaded
            }
            else = {
                for_each_scope_loop = {
                    array = global.russia_reworked_countries
                    break = break_loop

                    if = {
                        limit = {
                            NOT = {
                                has_country_flag = russia_reworked_country_loaded
                            }
                        }
                        set_country_flag = russia_rework_country_missing
                        add_to_variable = { global.russia_reworked_core_file_missing = 1 }
                    }
                }
            }

            if = {
                limit = {
                    check_variable = {
                        var = global.russia_reworked_core_file_missing
                        value = 1
                        compare = greater_than_or_equals
                    }
                }
                set_global_flag = russia_reworked_error
            }

            set_global_flag = russia_reworked_loaded
        }
    }
}