scripted_gui = {
    sov_national_obligations_scripted_gui = {
        window_name = "sov_national_obligations_scripted_gui_window"
        context_type = player_context

        visible = {
            original_tag = SOV
            is_subject = no
            OR = {
                has_country_flag = sov_debug_national_obligations
                AND = {
                    has_global_flag = sov_national_obligations_allowed
                    has_country_flag = sov_unlocked_national_obligations
                    has_country_flag = sov_open_national_obligations
                }
            }
        }

        properties = {
            sov_national_obligations_main_icon_left = {
                image = [THIS.GetCurrentSelectedIndexNationalObligationsIcon]
            }

            sov_national_obligations_main_icon_right = {
                image = [THIS.GetCurrentSelectedIndexNationalObligationsIcon]
            }

            sov_national_obligations_scripted_gui_window_bg = {
                image = [THIS.GetCurrentSelectedIndexNationalObligations]
            }

            sov_national_obligations_nav_industrial_awakening = {
                image = [THIS.GetCurrentSelectedIndexNationalObligationsNavIndustrialAwakening]
            }

            sov_national_obligations_nav_tsar_bomba = {
                image = [THIS.GetCurrentSelectedIndexNationalObligationsNavTsarBomba]
            }

            sov_national_obligations_nav_unfailing_army = {
                image = [THIS.GetCurrentSelectedIndexNationalObligationsNavUnfailingArmy]
            }

            sov_national_obligations_nav_grand_fleet = {
                image = [THIS.GetCurrentSelectedIndexNationalObligationsNavGrandFleet]
            }

            sov_national_obligations_nav_proletarian_union = {
                image = [THIS.GetCurrentSelectedIndexNationalObligationsNavProletarianUnion]
            }

            sov_national_obligations_nav_neverending_story = {
                image = [THIS.GetCurrentSelectedIndexNationalObligationsNavNeverendingStory]
            }

            sov_national_obligations_nav_continental_system = {
                image = [THIS.GetCurrentSelectedIndexNationalObligationsNavContinentalSystem]
            }

            sov_national_obligations_nav_treaty_moscow = {
                image = [THIS.GetCurrentSelectedIndexNationalObligationsNavTreatyMoscow]
            }

            sov_national_obligations_nav_golden_age = {
                image = [THIS.GetCurrentSelectedIndexNationalObligationsNavGoldenAge]
            }

            sov_national_obligations_nav_imperial_obligations = {
                image = [THIS.GetCurrentSelectedIndexNationalObligationsNavImperialObligations]
            }

            sov_national_obligations_nav_carry_on_legacy = {
                image = [THIS.GetCurrentSelectedIndexNationalObligationsNavCarryOnLegacy]
            }

            sov_national_obligations_nav_russian_realm = {
                image = [THIS.GetCurrentSelectedIndexNationalObligationsNavRussianRealm]
            }

            sov_national_obligations_nav_rebirth = {
                image = [THIS.GetCurrentSelectedIndexNationalObligationsNavRebirth]
            }
        }

        effects = {
            sov_national_obligations_help_button_click = {
                if = {
                    limit = {
                        check_variable = {
                            var = national_obligations_help_open_count
                            value = 0
                            compare = equals
                        }
                        NOT = {
                            is_in_array = { global.click_me_achievement = THIS }
                        }
                    }
                    add_to_array = { global.click_me_achievement = THIS }
                    set_variable = { global.click_me_achievement_date@THIS = global.date }
                    set_country_flag = russia_reworked_new_achievement
                    if = {
                        limit = {
                            has_global_flag = russia_reworked_achievements_enabled
                        }
                        scoped_sound_effect = "russia_reworked_unlock_achievement"
                    }
                }
                if = {
                    limit = {
                        NOT = {
                            has_country_flag = sov_open_national_obligations_help
                        }
                    }
                    set_country_flag = sov_open_national_obligations_help
                    add_to_variable = { national_obligations_help_open_count = 1 }
                }
            }

            sov_national_obligations_close_button_click = {
                if = {
                    limit = {
                        has_country_flag = sov_open_national_obligations_help
                    }
                    clr_country_flag = sov_open_national_obligations_help
                }
                if = {
                    limit = {
                        has_country_flag = sov_debug_national_obligations
                    }
                    clr_country_flag = sov_debug_national_obligations
                }
                if = {
                    limit = {
                        has_country_flag = sov_open_national_obligations
                    }
                    clr_country_flag = sov_open_national_obligations
                }
            }

            #NAV
            sov_national_obligation_nav_button_left_click = {
                set_temp_variable = { old_index = var:sov_national_obligations_selected_index }
                set_temp_variable = { new_index = var:sov_national_obligations_selected_index }
                while_loop_effect = {
                    break = break_loop
                    limit = {
                        OR = {
                            check_variable = {
                                var = old_index
                                value = var:sov_national_obligations_selected_index
                                compare = equals
                            }
                            check_variable = {
                                var = new_index
                                value = 0
                                compare = less_than_or_equals
                            }
                        }
                    }

                    subtract_from_temp_variable = { new_index = 1 }
                    if = {
                        limit = {
                            is_in_array = { sov_national_obligations_unlocked_indexes = new_index }
                        }
                        set_variable = { sov_national_obligations_selected_index = var:new_index }
                    }
                }
            }

            sov_national_obligation_nav_button_right_click = {
                set_temp_variable = { old_index = var:sov_national_obligations_selected_index }
                set_temp_variable = { new_index = var:sov_national_obligations_selected_index }
                while_loop_effect = {
                    break = break_loop
                    limit = {
                        OR = {
                            check_variable = {
                                var = old_index
                                value = var:sov_national_obligations_selected_index
                                compare = equals
                            }
                            check_variable = {
                                var = new_index
                                value = 100
                                compare = greater_than_or_equals
                            }
                        }
                    }

                    add_to_temp_variable = { new_index = 1 }
                    if = {
                        limit = {
                            is_in_array = { sov_national_obligations_unlocked_indexes = new_index }
                        }
                        set_variable = { sov_national_obligations_selected_index = var:new_index }
                    }
                }
            }

            sov_national_obligations_nav_industrial_awakening_click = {
                set_variable = { sov_national_obligations_selected_index = 1 }
            }

            sov_national_obligations_nav_tsar_bomba_click = {
                set_variable = { sov_national_obligations_selected_index = 2 }
            }

            sov_national_obligations_nav_unfailing_army_click = {
                set_variable = { sov_national_obligations_selected_index = 3 }
            }

            sov_national_obligations_nav_grand_fleet_click = {
                set_variable = { sov_national_obligations_selected_index = 4 }
            }

            sov_national_obligations_nav_proletarian_union_click = {
                set_variable = { sov_national_obligations_selected_index = 5 }
            }

            sov_national_obligations_nav_neverending_story_click = {
                set_variable = { sov_national_obligations_selected_index = 6 }
            }

            sov_national_obligations_nav_continental_system_click = {
                set_variable = { sov_national_obligations_selected_index = 7 }
            }

            sov_national_obligations_nav_treaty_moscow_click = {
                set_variable = { sov_national_obligations_selected_index = 8 }
            }

            sov_national_obligations_nav_golden_age_click = {
                set_variable = { sov_national_obligations_selected_index = 9 }
            }

            sov_national_obligations_nav_imperial_obligations_click = {
                set_variable = { sov_national_obligations_selected_index = 10 }
            }

            sov_national_obligations_nav_carry_on_legacy_click = {
                set_variable = { sov_national_obligations_selected_index = 11 }
            }

            sov_national_obligations_nav_russian_realm_click = {
                set_variable = { sov_national_obligations_selected_index = 12 }
            }

            sov_national_obligations_nav_rebirth_click = {
                set_variable = { sov_national_obligations_selected_index = 13 }
            }
        }

        #Triggers will always check for a precise number rather than "greater than" to avoid any possible bug (with a decimal variable for example)
        triggers = {
            sov_national_obligations_main_icon_left_glow_visible = {
                OR = {
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 1
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 2
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 3
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 4
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 5
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 6
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 7
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 8
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 9
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 10
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 11
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 12
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 13
                        compare = equals
                    }
                }
            }

            sov_national_obligations_main_icon_right_glow_visible = {
                OR = {
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 1
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 2
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 3
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 4
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 5
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 6
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 7
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 8
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 9
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 10
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 11
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 12
                        compare = equals
                    }
                    check_variable = {
                        var = sov_national_obligations_selected_index
                        value = 13
                        compare = equals
                    }
                }
            }

            #NAV
            sov_national_obligation_nav_button_left_click_enabled = {
                find_lowest_in_array = {
                    array = sov_national_obligations_unlocked_indexes
                    value = lowest_unlocked_index_v
                    index = lowest_unlocked_index_i
                }
                check_variable = {
                    var = lowest_unlocked_index_v
                    value = var:sov_national_obligations_selected_index
                    compare = less_than
                }
            }

            sov_national_obligation_nav_button_right_click_enabled = {
                find_highest_in_array = {
                    array = sov_national_obligations_unlocked_indexes
                    value = highest_unlocked_index_v
                    index = highest_unlocked_index_i
                }
                check_variable = {
                    var = highest_unlocked_index_v
                    value = var:sov_national_obligations_selected_index
                    compare = greater_than
                }
            }

            sov_national_obligations_nav_industrial_awakening_click_enabled = {
                is_in_array = { sov_national_obligations_unlocked_indexes = 1 }
            }

            sov_national_obligations_nav_tsar_bomba_click_enabled = {
                is_in_array = { sov_national_obligations_unlocked_indexes = 2 }
            }

            sov_national_obligations_nav_unfailing_army_click_enabled = {
                is_in_array = { sov_national_obligations_unlocked_indexes = 3 }
            }

            sov_national_obligations_nav_grand_fleet_click_enabled = {
                is_in_array = { sov_national_obligations_unlocked_indexes = 4 }
            }

            sov_national_obligations_nav_proletarian_union_click_enabled = {
                is_in_array = { sov_national_obligations_unlocked_indexes = 5 }
            }

            sov_national_obligations_nav_neverending_story_click_enabled = {
                is_in_array = { sov_national_obligations_unlocked_indexes = 6 }
            }

            sov_national_obligations_nav_continental_system_click_enabled = {
                is_in_array = { sov_national_obligations_unlocked_indexes = 7 }
            }

            sov_national_obligations_nav_golden_age_click_enabled = {
                is_in_array = { sov_national_obligations_unlocked_indexes = 8 }
            }

            sov_national_obligations_nav_treaty_moscow_click_enabled = {
                is_in_array = { sov_national_obligations_unlocked_indexes = 9 }
            }

            sov_national_obligations_nav_imperial_obligations_click_enabled = {
                is_in_array = { sov_national_obligations_unlocked_indexes = 10 }
            }

            sov_national_obligations_nav_carry_on_legacy_click_enabled = {
                is_in_array = { sov_national_obligations_unlocked_indexes = 11 }
            }

            sov_national_obligations_nav_russian_realm_click_enabled = {
                is_in_array = { sov_national_obligations_unlocked_indexes = 12 }
            }

            sov_national_obligations_nav_rebirth_click_enabled = {
                is_in_array = { sov_national_obligations_unlocked_indexes = 13 }
            }
        }
    }

    #Industrial Awakening
    sov_national_obligations_industrial_awakening_scripted_gui = {
        window_name = "sov_national_obligations_industrial_awakening_view"
        context_type = player_context
        parent_window_name = "sov_national_obligations_scripted_gui_window"

        visible = {
            check_variable = {
                var = sov_national_obligations_selected_index
                value = 1
                compare = equals
            }
        }

        properties = {
            sov_national_obligations_industrial_awakening_first_option_bg = {
                image = [THIS.GetCurrentStatusFirstOptionIndustrialAwakening]
            }

            sov_national_obligations_industrial_awakening_second_option_bg = {
                image = [THIS.GetCurrentStatusSecondOptionIndustrialAwakening]
            }

            sov_national_obligations_industrial_awakening_third_option_bg = {
                image = [THIS.GetCurrentStatusThirdOptionIndustrialAwakening]
            }
        }

        effects = {
            sov_national_obligations_industrial_awakening_confirm_button_click = {
                THIS = {
                    #TODO
					if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_industrial_awakening_selected_index = 1
                            }
                        }
                        add_ideas = SOV_industrially_awakened
                    }
                    else_if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_industrial_awakening_selected_index = 2
                            }
                        }
						set_victory_points = { province = 3529 value = 100 }
						set_victory_points = { province = 9417 value = 100 }
						set_victory_points = { province = 3686 value = 100 }
						set_victory_points = { province = 11370 value = 100 }
						set_victory_points = { province = 6380 value = 100 }
						set_victory_points = { province = 3151 value = 100 }
						set_victory_points = { province = 306 value = 100 }
						set_victory_points = { province = 957 value = 100 }
						217 = {
							set_state_category = megalopolis
							add_building_construction = {
								type = infrastructure
								level = 5
								instant_build = yes
							}
							add_building_construction = {
								type = industrial_complex
								level = 3
								instant_build = yes
							}
							add_building_construction = {
								type = arms_factory
								level = 3
								instant_build = yes
							}
							add_dynamic_modifier = { modifier = SOV_megacity }
						}
						137 = {
							set_state_category = megalopolis
							add_building_construction = {
								type = infrastructure
								level = 5
								instant_build = yes
							}
							add_building_construction = {
								type = industrial_complex
								level = 3
								instant_build = yes
							}
							add_building_construction = {
								type = dockyard
								level = 3
								instant_build = yes
							}
							add_dynamic_modifier = { modifier = SOV_megacity }
						}
						218 = {
							set_state_category = megalopolis
							add_building_construction = {
								type = infrastructure
								level = 5
								instant_build = yes
							}
							add_building_construction = {
								type = industrial_complex
								level = 3
								instant_build = yes
							}
							add_building_construction = {
								type = arms_factory
								level = 3
								instant_build = yes
							}
							add_dynamic_modifier = { modifier = SOV_megacity }
						}
						202 = {
							set_state_category = megalopolis
							add_building_construction = {
								type = infrastructure
								level = 5
								instant_build = yes
							}
							add_building_construction = {
								type = industrial_complex
								level = 3
								instant_build = yes
							}
							add_building_construction = {
								type = arms_factory
								level = 3
								instant_build = yes
							}
							add_dynamic_modifier = { modifier = SOV_megacity }
						}
						206 = {
							set_state_category = megalopolis
							add_building_construction = {
								type = infrastructure
								level = 5
								instant_build = yes
							}
							add_building_construction = {
								type = industrial_complex
								level = 3
								instant_build = yes
							}
							add_building_construction = {
								type = arms_factory
								level = 3
								instant_build = yes
							}
							add_dynamic_modifier = { modifier = SOV_megacity }
						}
						242 = {
							set_state_category = megalopolis
							add_building_construction = {
								type = infrastructure
								level = 5
								instant_build = yes
							}
							add_building_construction = {
								type = industrial_complex
								level = 3
								instant_build = yes
							}
							add_building_construction = {
								type = arms_factory
								level = 3
								instant_build = yes
							}
							add_dynamic_modifier = { modifier = SOV_megacity }
						}
						219 = {
							set_state_category = megalopolis
							add_building_construction = {
								type = infrastructure
								level = 5
								instant_build = yes
							}
							add_building_construction = {
								type = industrial_complex
								level = 3
								instant_build = yes
							}
							add_building_construction = {
								type = arms_factory
								level = 3
								instant_build = yes
							}
							add_dynamic_modifier = { modifier = SOV_megacity }
						}
						195 = {
							set_state_category = megalopolis
							add_building_construction = {
								type = infrastructure
								level = 5
								instant_build = yes
							}
							add_building_construction = {
								type = industrial_complex
								level = 3
								instant_build = yes
							}
							add_building_construction = {
								type = arms_factory
								level = 3
								instant_build = yes
							}
							add_dynamic_modifier = { modifier = SOV_megacity }
						}
						408 = {
							set_state_category = megalopolis
							add_building_construction = {
								type = infrastructure
								level = 5
								instant_build = yes
							}
							add_building_construction = {
								type = industrial_complex
								level = 3
								instant_build = yes
							}
							add_building_construction = {
								type = dockyard
								level = 3
								instant_build = yes
							}
							add_dynamic_modifier = { modifier = SOV_megacity }
						}
							ROOT = {
								build_railway = {
								level = 5
								build_only_on_allied = yes
								controller_priority = {
								base = 1
								}
								fallback = yes
								start_state  = 219
								target_state = 217
								}
							}
							ROOT = {
								build_railway = {
								level = 5
								build_only_on_allied = yes
								controller_priority = {
								base = 1
								}
								fallback = yes
								start_state  = 219
								target_state = 137
								}
							}
							ROOT = {
								build_railway = {
								level = 5
								build_only_on_allied = yes
								controller_priority = {
								base = 1
								}
								fallback = yes
								start_state  = 219
								target_state = 218
								}
							}
							ROOT = {
								build_railway = {
								level = 5
								build_only_on_allied = yes
								controller_priority = {
								base = 1
								}
								fallback = yes
								start_state  = 219
								target_state = 202
								}
							}
							ROOT = {
								build_railway = {
								level = 5
								build_only_on_allied = yes
								controller_priority = {
								base = 1
								}
								fallback = yes
								start_state  = 219
								target_state = 206
								}
							}
							ROOT = {
								build_railway = {
								level = 5
								build_only_on_allied = yes
								controller_priority = {
								base = 1
								}
								fallback = yes
								start_state  = 219
								target_state = 242
								}
							}
							ROOT = {
								build_railway = {
								level = 5
								build_only_on_allied = yes
								controller_priority = {
								base = 1
								}
								fallback = yes
								start_state  = 219
								target_state = 195
								}
							}
							ROOT = {
								build_railway = {
								level = 5
								build_only_on_allied = yes
								controller_priority = {
								base = 1
								}
								fallback = yes
								start_state  = 219
								target_state = 408
								}
							}
                    }
					else_if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_industrial_awakening_selected_index = 3
                            }
                        }
                        add_ideas = SOV_national_obligations_test_option_3
                    }
                    SOV_set_up_industrial_awakening = yes
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations_help
                        }
                        clr_country_flag = sov_open_national_obligations_help
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_debug_national_obligations
                        }
                        clr_country_flag = sov_debug_national_obligations
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations
                        }
                        clr_country_flag = sov_open_national_obligations
                    }
                }
            }

            sov_national_obligations_industrial_awakening_first_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_industrial_awakening_selected_index = 1
                            }
                        }
                        set_variable = {
                            sov_national_obligations_industrial_awakening_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_industrial_awakening_selected_index = 1
                        }
                    }
                }
            }

            sov_national_obligations_industrial_awakening_second_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_industrial_awakening_selected_index = 2
                            }
                        }
                        set_variable = {
                            sov_national_obligations_industrial_awakening_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_industrial_awakening_selected_index = 2
                        }
                    }
                }
            }

            sov_national_obligations_industrial_awakening_third_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_industrial_awakening_selected_index = 3
                            }
                        }
                        set_variable = {
                            sov_national_obligations_industrial_awakening_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_industrial_awakening_selected_index = 3
                        }
                    }
                }
            }
        }

        triggers = {
            sov_national_obligations_industrial_awakening_confirm_button_click_enabled = {
                THIS = {
                    OR = {
                        check_variable = {
                            sov_national_obligations_industrial_awakening_selected_index = 1
                        }
                        check_variable = {
                            sov_national_obligations_industrial_awakening_selected_index = 2
                        }
                        check_variable = {
                            sov_national_obligations_industrial_awakening_selected_index = 3
                        }
                    }
					if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_industrial_awakening_selected_index = 2
                            }
                        }
                         has_full_control_of_state = 217
						has_full_control_of_state = 137
						has_full_control_of_state = 206
						has_full_control_of_state = 218
						has_full_control_of_state = 202
						has_full_control_of_state = 242
						has_full_control_of_state = 219
						has_full_control_of_state = 195
						has_full_control_of_state = 408
                    }
                    NOT = {
                        has_country_flag = industrial_awakening_confirmed
                    }
                }
            }

            sov_national_obligations_industrial_awakening_first_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_industrial_awakening_selected_index = 1
                }
            }

            sov_national_obligations_industrial_awakening_first_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = industrial_awakening_confirmed
                    }
                }
            }

            sov_national_obligations_industrial_awakening_second_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_industrial_awakening_selected_index = 2
                }
            }

            sov_national_obligations_industrial_awakening_second_option_button_click_enabled = {
                THIS = {
                    has_full_control_of_state = 217
					has_full_control_of_state = 137
					has_full_control_of_state = 206
					has_full_control_of_state = 218
					has_full_control_of_state = 202
					has_full_control_of_state = 242
					has_full_control_of_state = 219
					has_full_control_of_state = 195
					has_full_control_of_state = 408
                    NOT = {
                        has_country_flag = industrial_awakening_confirmed
                    }
                }
            }

            sov_national_obligations_industrial_awakening_third_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_industrial_awakening_selected_index = 3
                }
            }

            sov_national_obligations_industrial_awakening_third_option_button_click_enabled = {
                THIS = {
                    NOT = {
                        has_country_flag = industrial_awakening_confirmed
                    }
                }
            }
        }
    }

    #Tsar Bomba
    sov_national_obligations_tsar_bomba_scripted_gui = {
        window_name = "sov_national_obligations_tsar_bomba_view"
        context_type = player_context
        parent_window_name = "sov_national_obligations_scripted_gui_window"

        visible = {
            check_variable = {
                var = sov_national_obligations_selected_index
                value = 2
                compare = equals
            }
        }

        properties = {
            sov_national_obligations_tsar_bomba_first_option_bg = {
                image = [THIS.GetCurrentStatusFirstOptionTsarBomba]
            }

            sov_national_obligations_tsar_bomba_second_option_bg = {
                image = [THIS.GetCurrentStatusSecondOptionTsarBomba]
            }
        }

        effects = {
            sov_national_obligations_tsar_bomba_confirm_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_tsar_bomba_selected_index = 1
                            }
                        }
                        add_ideas = SOV_Major_nuclear_power
                    }
                    else_if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_tsar_bomba_selected_index = 2
                            }
                        }
                        add_nuclear_bombs = -3
                        goto_state = 262
                        launch_nuke = {
                            province = 11047
                            use_nuke = no
                        }
                        launch_nuke = {
                            province = 6192
                            use_nuke = no
                        }
                        launch_nuke = {
                            province = 12530
                            use_nuke = no
                        }
                        country_event = { id = russia2_russia.633 days = 2 }
                    }
                    set_country_flag = tsar_bomba_confirmed
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations_help
                        }
                        clr_country_flag = sov_open_national_obligations_help
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_debug_national_obligations
                        }
                        clr_country_flag = sov_debug_national_obligations
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations
                        }
                        clr_country_flag = sov_open_national_obligations
                    }
                }
            }

            sov_national_obligations_tsar_bomba_first_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_tsar_bomba_selected_index = 1
                            }
                        }
                        set_variable = {
                            sov_national_obligations_tsar_bomba_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_tsar_bomba_selected_index = 1
                        }
                    }
                }
            }

            sov_national_obligations_tsar_bomba_second_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_tsar_bomba_selected_index = 2
                            }
                        }
                        set_variable = {
                            sov_national_obligations_tsar_bomba_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_tsar_bomba_selected_index = 2
                        }
                    }
                }
            }
        }

        triggers = {
            sov_national_obligations_tsar_bomba_confirm_button_click_enabled = {
                THIS = {
                    OR = {
                        check_variable = {
                            sov_national_obligations_tsar_bomba_selected_index = 1
                        }
                        check_variable = {
                            sov_national_obligations_tsar_bomba_selected_index = 2
                        }
                    }
                    NOT = {
                        has_country_flag = tsar_bomba_confirmed
                    }
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_tsar_bomba_selected_index = 1
                            }
                        }
                        has_tech = nuclear_reactor
                    }
                    else_if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_tsar_bomba_selected_index = 2
                            }
                        }
                        has_full_control_of_state = 262
                        num_of_nukes > 2
                    }
                }
            }

            sov_national_obligations_tsar_bomba_first_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_tsar_bomba_selected_index = 1
                }
            }

            sov_national_obligations_tsar_bomba_first_option_button_click_enabled = {
                THIS = {
                    has_tech = nuclear_reactor
                    NOT = {
                        has_country_flag = tsar_bomba_confirmed
                    }
                }
            }

            sov_national_obligations_tsar_bomba_second_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_tsar_bomba_selected_index = 2
                }
            }

            sov_national_obligations_tsar_bomba_second_option_button_click_enabled = {
                THIS = {
                    has_full_control_of_state = 262
                    num_of_nukes > 2
                    NOT = {
                        has_country_flag = tsar_bomba_confirmed
                    }
                }
            }
        }
    }

    #Unfailing Army
    sov_national_obligations_unfailing_army_scripted_gui = {
        window_name = "sov_national_obligations_unfailing_army_view"
        context_type = player_context
        parent_window_name = "sov_national_obligations_scripted_gui_window"

        visible = {
            check_variable = {
                var = sov_national_obligations_selected_index
                value = 3
                compare = equals
            }
        }

        properties = {
            sov_national_obligations_unfailing_army_first_option_bg = {
                image = [THIS.GetCurrentStatusFirstOptionUnfailingArmy]
            }

            sov_national_obligations_unfailing_army_second_option_bg = {
                image = [THIS.GetCurrentStatusSecondOptionUnfailingArmy]
            }
        }

        effects = {
           sov_national_obligations_unfailing_army_confirm_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_unfailing_army_selected_index = 1
                            }
                        }
                        set_country_flag = unfailing_army_offense_flag
						set_variable = { var = uao_offence value = 0.0 }
						set_variable = { var = uao_land_night_attack value = 0 }
						set_variable = { var = uao_attack_factor value = 0 }
						set_variable = { var = uao_core_attack_factor value = 0 }
						set_variable = { var = uao_speed_factor value = 0 }
						set_variable = { var = uao_army_org value = 0 }
						set_variable = { var = uao_armor_attack value = 0 }
						set_variable = { var = uao_org_loss_moving value = 0 }
						set_variable = { var = uao_breakthrough value = 0 }
						set_variable = { var = uao_fort_damage value = 0 }
						set_variable = { var = uao_supply_consumption value = 0 }
						set_variable = { var = uao_winter_attrition value = 0 }
						set_variable = { var = uao_heat_attrition value = 0 }
						set_variable = { var = uao_river_crossing value = 0 }
						set_variable = { var = uao_terrain value = 0 }		
						SOV = {
							set_variable = { zcurrent_state_number = num_controlled_states }
						}
					}
                    else_if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_unfailing_army_selected_index = 2
                            }
                        }
						set_country_flag = unfailing_army_defense_flag
						set_variable = { var = uad_defence value = 0 }
						set_variable = { var = uad_defence_factor value = 0 }
						set_variable = { var = uad_core_defence value = 0 }
						set_variable = { var = uad_org_regain value = 0 }
						set_variable = { var = uad_recovery value = 0 }
						set_variable = { var = uad_entrench_speed value = 0 }
						set_variable = { var = uad_entrench_factor value = 0 }
						set_variable = { var = uad_recon value = 0 }
						set_variable = { var = uad_entrenched_recon value = 0 }
						set_variable = { var = uad_out_of_supply value = 0 }
						set_variable = { var = uad_supply_grace value = 0 }
						set_variable = { var = uad_pocket_penalty value = 0 }
						set_variable = { var = uad_fort_damage value = 0 }
						set_variable = { var = uad_reinforce value = 0 }
						set_variable = { var = uad_speed value = 0 }
						set_variable = { var = uad_org value = 0 }
						set_variable = { var = uad_supply_consumption value = 0 }
						set_variable = { var = uad_winter_attrition value = 0 }
						set_variable = { var = uad_heat_attrition value = 0 }
						set_variable = { var = uad_terrain value = 0 }
						SOV = {
							set_variable = { zcurrent_state_number = num_controlled_states }
						}
                    }
                    set_country_flag = unfailing_army_confirmed
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations_help
                        }
                        clr_country_flag = sov_open_national_obligations_help
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_debug_national_obligations
                        }
                        clr_country_flag = sov_debug_national_obligations
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations
                        }
                        clr_country_flag = sov_open_national_obligations
                    }
                }
	}
            

            sov_national_obligations_unfailing_army_first_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_unfailing_army_selected_index = 1
                            }
                        }
                        set_variable = {
                            sov_national_obligations_unfailing_army_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_unfailing_army_selected_index = 1
                        }
                    }
                }
            }

            sov_national_obligations_unfailing_army_second_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_unfailing_army_selected_index = 2
                            }
                        }
                        set_variable = {
                            sov_national_obligations_unfailing_army_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_unfailing_army_selected_index = 2
                        }
                    }
                }
            }
        }

        triggers = {
            sov_national_obligations_unfailing_army_confirm_button_click_enabled = {
                THIS = {
                    OR = {
                        check_variable = {
                            sov_national_obligations_unfailing_army_selected_index = 1
                        }
                        check_variable = {
                            sov_national_obligations_unfailing_army_selected_index = 2
                        }
                    }
                    NOT = {
                        has_country_flag = unfailing_army_confirmed
                    }
                }
            }

            sov_national_obligations_unfailing_army_first_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_unfailing_army_selected_index = 1
                }
            }

            sov_national_obligations_unfailing_army_first_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = unfailing_army_confirmed
                    }
                }
            }

            sov_national_obligations_unfailing_army_second_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_unfailing_army_selected_index = 2
                }
            }

            sov_national_obligations_unfailing_army_second_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = unfailing_army_confirmed
                    }
                }
            }
        }
    }

    #Grand Fleet
    sov_national_obligations_grand_fleet_scripted_gui = {
        window_name = "sov_national_obligations_grand_fleet_view"
        context_type = player_context
        parent_window_name = "sov_national_obligations_scripted_gui_window"

        visible = {
            check_variable = {
                var = sov_national_obligations_selected_index
                value = 4
                compare = equals
            }
        }

        properties = {
            sov_national_obligations_grand_fleet_first_option_bg = {
                image = [THIS.GetCurrentStatusFirstOptionGrandFleet]
            }

            sov_national_obligations_grand_fleet_second_option_bg = {
                image = [THIS.GetCurrentStatusSecondOptionGrandFleet]
            }
        }

        effects = {
            sov_national_obligations_grand_fleet_confirm_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_grand_fleet_selected_index = 1
                            }
                        }
                        every_state = {
							limit = {
								AND = {
									is_core_of = SOV
									is_coastal = yes
								}
							}
							add_extra_state_shared_building_slots = 1
							add_building_construction = {
								type = dockyard
								level = 1
								instant_build = yes
							}
						}
						add_building_construction = {
							type = naval_base
							province = 11670
							level = 7
							instant_build = yes
						}
						add_building_construction = {
							type = naval_base
							province = 9417
							level = 5
							instant_build = yes
						}
						add_building_construction = {
							type = naval_base
							province = 719
							level = 7
							instant_build = yes
						}
						add_building_construction = {
							type = naval_base
							province = 9680
							level = 9
							instant_build = yes
						}
						add_building_construction = {
							type = naval_base
							province = 3653
							level = 8
							instant_build = yes
						}
						add_building_construction = {
							type = naval_base
							province = 3134
							level = 6
							instant_build = yes
						}
						add_building_construction = {
							type = naval_base
							province = 3338
							level = 7
							instant_build = yes
						}
						add_building_construction = {
							type = naval_base
							province = 12530
							level = 9
							instant_build = yes
						}
						add_building_construction = {
							type = naval_base
							province = 13204
							level = 9
							instant_build = yes
						}
						add_building_construction = {
							type = naval_base
							province = 12207
							level = 9
							instant_build = yes
						}
						add_building_construction = {
							type = naval_base
							province = 9604
							level = 9
							instant_build = yes
						}
						add_building_construction = {
							type = naval_base
							province = 957
							level = 2
							instant_build = yes
						}
                    }
					if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_grand_fleet_selected_index = 2
                            }
                        }
                        SOV_set_up_grand_fleet = yes
                    }
                    set_country_flag = grand_fleet_confirmed
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations_help
                        }
                        clr_country_flag = sov_open_national_obligations_help
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_debug_national_obligations
                        }
                        clr_country_flag = sov_debug_national_obligations
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations
                        }
                        clr_country_flag = sov_open_national_obligations
                    }
                }
            }

            sov_national_obligations_grand_fleet_first_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_grand_fleet_selected_index = 1
                            }
                        }
                        set_variable = {
                            sov_national_obligations_grand_fleet_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_grand_fleet_selected_index = 1
                        }
                    }
                }
            }

            sov_national_obligations_grand_fleet_second_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_grand_fleet_selected_index = 2
                            }
                        }
                        set_variable = {
                            sov_national_obligations_grand_fleet_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_grand_fleet_selected_index = 2
                        }
                    }
                }
            }
        }

        triggers = {
            sov_national_obligations_grand_fleet_confirm_button_click_enabled = {
                THIS = {
                    OR = {
                        check_variable = {
                            sov_national_obligations_grand_fleet_selected_index = 1
                        }
                        check_variable = {
                            sov_national_obligations_grand_fleet_selected_index = 2
                        }
                    }
                    NOT = {
                        has_country_flag = grand_fleet_confirmed
                    }
                }
            }

            sov_national_obligations_grand_fleet_first_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_grand_fleet_selected_index = 1
                }
            }

            sov_national_obligations_grand_fleet_first_option_button_click_enabled = {
                THIS = {
                    any_owned_state = {
						is_coastal = yes
					}
                    NOT = {
                        has_country_flag = grand_fleet_confirmed
                    }
                }
            }

            sov_national_obligations_grand_fleet_second_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_grand_fleet_selected_index = 2
                }
            }

            sov_national_obligations_grand_fleet_second_option_button_click_enabled = {
                THIS = {
                    has_navy_size = {
						size > 1
						type = capital_ship
					}
                    NOT = {
                        has_country_flag = grand_fleet_confirmed
                    }
                }
            }
        }
    }

    #Proletarian Union
    sov_national_obligations_proletarian_union_scripted_gui = {
        window_name = "sov_national_obligations_proletarian_union_view"
        context_type = player_context
        parent_window_name = "sov_national_obligations_scripted_gui_window"

        visible = {
            check_variable = {
                var = sov_national_obligations_selected_index
                value = 5
                compare = equals
            }
        }

        properties = {
            sov_national_obligations_proletarian_union_first_option_bg = {
                image = [THIS.GetCurrentStatusFirstOptionProletarianUnion]
            }

            sov_national_obligations_proletarian_union_second_option_bg = {
                image = [THIS.GetCurrentStatusSecondOptionProletarianUnion]
            }

            sov_national_obligations_proletarian_union_third_option_bg = {
                image = [THIS.GetCurrentStatusThirdOptionProletarianUnion]
            }
        }

        effects = {
            sov_national_obligations_proletarian_union_confirm_button_click = {
                THIS = {
					if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_proletarian_union_selected_index = 1
                            }
                        }
						set_cosmetic_tag = SOV_proletarian_union
						every_other_country = {
							limit = {
								is_subject_of = SOV
							}
							country_event = russia2_russia.662
						}
						hidden_effect = {
							country_event = { id = russia2_russia.6650 hours = 36 }
						}
					}
					if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_proletarian_union_selected_index = 2
                            }
                        }
						set_cosmetic_tag = SOV_proletarian_union
						set_country_flag = SOV_proletarian_union_option_2
						set_variable = { var = number_of_proletarian_members value = 1 }
						unlock_decision_category_tooltip = SOV_invite_to_proletarian_union
					}
					if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_proletarian_union_selected_index = 3
                            }
                        }
						every_other_country = {
							limit = {
								OR = {
									has_government = communism
									is_subject_of = SOV
								}
							}
							country_event = {
								id = russia2_russia.672
								hours = 12
							}
						}
						create_faction = proletarian_union_faction
						set_cosmetic_tag = SOV_proletarian_union
						add_ideas = SOV_proletarian_union_leader
						set_country_flag = SOV_proletarian_union_option_3
					}
                    set_country_flag = proletarian_union_confirmed
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations_help
                        }
                        clr_country_flag = sov_open_national_obligations_help
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_debug_national_obligations
                        }
                        clr_country_flag = sov_debug_national_obligations
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations
                        }
                        clr_country_flag = sov_open_national_obligations
                    }
                }
            }

            sov_national_obligations_proletarian_union_first_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_proletarian_union_selected_index = 1
                            }
                        }
                        set_variable = {
                            sov_national_obligations_proletarian_union_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_proletarian_union_selected_index = 1
                        }
                    }
                }
            }

            sov_national_obligations_proletarian_union_second_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_proletarian_union_selected_index = 2
                            }
                        }
                        set_variable = {
                            sov_national_obligations_proletarian_union_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_proletarian_union_selected_index = 2
                        }
                    }
                }
            }

            sov_national_obligations_proletarian_union_third_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_proletarian_union_selected_index = 3
                            }
                        }
                        set_variable = {
                            sov_national_obligations_proletarian_union_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_proletarian_union_selected_index = 3
                        }
                    }
                }
            }
        }

        triggers = {
            sov_national_obligations_proletarian_union_confirm_button_click_enabled = {
                THIS = {
                    OR = {
                        check_variable = {
                            sov_national_obligations_proletarian_union_selected_index = 1
                        }
                        check_variable = {
                            sov_national_obligations_proletarian_union_selected_index = 2
                        }
                        check_variable = {
                            sov_national_obligations_proletarian_union_selected_index = 3
                        }
                    }
                    NOT = {
                        has_country_flag = proletarian_union_confirmed
                    }
                }
            }

            sov_national_obligations_proletarian_union_first_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_proletarian_union_selected_index = 1
                }
            }

            sov_national_obligations_proletarian_union_first_option_button_click_enabled = {
                THIS = {
                    num_subjects > 19
                    NOT = {
                        has_country_flag = proletarian_union_confirmed
                    }
                }
            }

            sov_national_obligations_proletarian_union_second_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_proletarian_union_selected_index = 2
                }
            }

            sov_national_obligations_proletarian_union_second_option_button_click_enabled = {
                THIS = {
                    num_faction_members > 9
                    NOT = {
                        has_country_flag = proletarian_union_confirmed
                    }
                }
            }

            sov_national_obligations_proletarian_union_third_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_proletarian_union_selected_index = 3
                }
            }

            sov_national_obligations_proletarian_union_third_option_button_click_enabled = {
                THIS = {
                    has_country_leader = {
                        character = SOV_Joseph_stalin
                        ruling_only = yes
                    }
                    NOT = {
                        has_country_flag = proletarian_union_confirmed
                    }
                }
            }
        }
    }

    #Neverending Story
    sov_national_obligations_neverending_story_scripted_gui = {
        window_name = "sov_national_obligations_neverending_story_view"
        context_type = player_context
        parent_window_name = "sov_national_obligations_scripted_gui_window"

        visible = {
            check_variable = {
                var = sov_national_obligations_selected_index
                value = 6
                compare = equals
            }
        }

        properties = {
            sov_national_obligations_neverending_story_first_option_bg = {
                image = [THIS.GetCurrentStatusFirstOptionNeverendingStory]
            }

            sov_national_obligations_neverending_story_second_option_bg = {
                image = [THIS.GetCurrentStatusSecondOptionNeverendingStory]
            }

            sov_national_obligations_neverending_story_third_option_bg = {
                image = [THIS.GetCurrentStatusThirdOptionNeverendingStory]
            }
        }

        effects = {
            sov_national_obligations_neverending_story_confirm_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_neverending_story_selected_index = 1
                            }
                        }
						set_country_flag = neverending_story_communist_coalition
                    }
                    else_if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_neverending_story_selected_index = 2
                            }
                        }
						country_event = { id = russia2_russia.669 days = 1 }
                        country_event = { id = russia2_russia.668 days = 380 }
						swap_ideas = {
							remove_idea = SOV_Dancing_revolution
							add_idea = SOV_permanent_revolution
						}
                    }
		    else_if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_neverending_story_selected_index = 3
                            }
                        }
                         set_country_flag = sov_never_ending_story_option_3
                    }
                    set_country_flag = neverending_story_confirmed
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations_help
                        }
                        clr_country_flag = sov_open_national_obligations_help
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_debug_national_obligations
                        }
                        clr_country_flag = sov_debug_national_obligations
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations
                        }
                        clr_country_flag = sov_open_national_obligations
                    }
                }
            }

            sov_national_obligations_neverending_story_first_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_neverending_story_selected_index = 1
                            }
                        }
                        set_variable = {
                            sov_national_obligations_neverending_story_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_neverending_story_selected_index = 1
                        }
                    }
                }
            }

            sov_national_obligations_neverending_story_second_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_neverending_story_selected_index = 2
                            }
                        }
                        set_variable = {
                            sov_national_obligations_neverending_story_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_neverending_story_selected_index = 2
                        }
                    }
                }
            }

            sov_national_obligations_neverending_story_third_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_neverending_story_selected_index = 3
                            }
                        }
                        set_variable = {
                            sov_national_obligations_neverending_story_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_neverending_story_selected_index = 3
                        }
                    }
                }
            }
        }

        triggers = {
            sov_national_obligations_neverending_story_confirm_button_click_enabled = {
                THIS = {
                    OR = {
                        check_variable = {
                            sov_national_obligations_neverending_story_selected_index = 1
                        }
                        check_variable = {
                            sov_national_obligations_neverending_story_selected_index = 2
                        }
                        check_variable = {
                            sov_national_obligations_neverending_story_selected_index = 3
                        }
                    }
                    NOT = {
                        has_country_flag = neverending_story_confirmed
                    }
                }
            }

            sov_national_obligations_neverending_story_first_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_neverending_story_selected_index = 1
                }
            }

            sov_national_obligations_neverending_story_first_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = neverending_story_confirmed
                    }
                }
            }

            sov_national_obligations_neverending_story_second_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_neverending_story_selected_index = 2
                }
            }

            sov_national_obligations_neverending_story_second_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = neverending_story_confirmed
                    }
                }
            }

            sov_national_obligations_neverending_story_third_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_neverending_story_selected_index = 3
                }
            }

            sov_national_obligations_neverending_story_third_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = neverending_story_confirmed
                    }
                }
            }
        }
    }

    #Continental System
    sov_national_obligations_continental_system_scripted_gui = {
        window_name = "sov_national_obligations_continental_system_view"
        context_type = player_context
        parent_window_name = "sov_national_obligations_scripted_gui_window"

        visible = {
            check_variable = {
                var = sov_national_obligations_selected_index
                value = 7
                compare = equals
            }
        }

        properties = {
            sov_national_obligations_continental_system_first_option_bg = {
                image = [THIS.GetCurrentStatusFirstOptionContinentalSystem]
            }

            sov_national_obligations_continental_system_second_option_bg = {
                image = [THIS.GetCurrentStatusSecondOptionContinentalSystem]
            }
        }

        effects = {
            sov_national_obligations_continental_system_confirm_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_continental_system_selected_index = 1
                            }
                        }
						country_event = { id = russia2_russia.670 days = 1 }
                    }
                    else_if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_continental_system_selected_index = 2
                            }
                        }
						set_global_flag = continental_system_creating
						add_ideas = SOV_system_enforcer
						set_rule = {
							can_declare_war_on_same_ideology = yes
							can_only_justify_war_on_threat_country = no
						}
                    }
                    set_country_flag = continental_system_confirmed
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations_help
                        }
                        clr_country_flag = sov_open_national_obligations_help
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_debug_national_obligations
                        }
                        clr_country_flag = sov_debug_national_obligations
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations
                        }
                        clr_country_flag = sov_open_national_obligations
                    }
                }
            }

            sov_national_obligations_continental_system_first_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_continental_system_selected_index = 1
                            }
                        }
                        set_variable = {
                            sov_national_obligations_continental_system_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_continental_system_selected_index = 1
                        }
                    }
                }
            }

            sov_national_obligations_continental_system_second_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_continental_system_selected_index = 2
                            }
                        }
                        set_variable = {
                            sov_national_obligations_continental_system_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_continental_system_selected_index = 2
                        }
                    }
                }
            }
        }

        triggers = {
            sov_national_obligations_continental_system_confirm_button_click_enabled = {
                THIS = {
                    OR = {
                        check_variable = {
                            sov_national_obligations_continental_system_selected_index = 1
                        }
                        check_variable = {
                            sov_national_obligations_continental_system_selected_index = 2
                        }
                    }
                    NOT = {
                        has_country_flag = continental_system_confirmed
                    }
                }
            }

            sov_national_obligations_continental_system_first_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_continental_system_selected_index = 1
                }
            }

            sov_national_obligations_continental_system_first_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = continental_system_confirmed
                    }
                }
            }

            sov_national_obligations_continental_system_second_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_continental_system_selected_index = 2
                }
            }

            sov_national_obligations_continental_system_second_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = continental_system_confirmed
                    }
                }
            }
        }
    }

    #Treaty Moscow
    sov_national_obligations_treaty_moscow_scripted_gui = {
        window_name = "sov_national_obligations_treaty_moscow_view"
        context_type = player_context
        parent_window_name = "sov_national_obligations_scripted_gui_window"

        visible = {
            check_variable = {
                var = sov_national_obligations_selected_index
                value = 8
                compare = equals
            }
        }

        properties = {
            sov_national_obligations_treaty_moscow_first_option_bg = {
                image = [THIS.GetCurrentStatusFirstOptionTreatyMoscow]
            }

            sov_national_obligations_treaty_moscow_second_option_bg = {
                image = [THIS.GetCurrentStatusSecondOptionTreatyMoscow]
            }
        }

        effects = {
            sov_national_obligations_treaty_moscow_confirm_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_treaty_moscow_selected_index = 1
                            }
                        }
						set_country_flag = treaty_of_moscow_forming_coalition
						country_event = { id = russia2_russia.703 days = 1 }
						add_ideas = treaty_of_moscow_idea
                    }
                    else_if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_treaty_moscow_selected_index = 2
                            }
                        }
						add_ideas = treaty_of_moscow_natspi
                    }
                    set_country_flag = treaty_moscow_confirmed
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations_help
                        }
                        clr_country_flag = sov_open_national_obligations_help
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_debug_national_obligations
                        }
                        clr_country_flag = sov_debug_national_obligations
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations
                        }
                        clr_country_flag = sov_open_national_obligations
                    }
                }
            }

            sov_national_obligations_treaty_moscow_first_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_treaty_moscow_selected_index = 1
                            }
                        }
                        set_variable = {
                            sov_national_obligations_treaty_moscow_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_treaty_moscow_selected_index = 1
                        }
                    }
                }
            }

            sov_national_obligations_treaty_moscow_second_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_treaty_moscow_selected_index = 2
                            }
                        }
                        set_variable = {
                            sov_national_obligations_treaty_moscow_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_treaty_moscow_selected_index = 2
                        }
                    }
                }
            }
        }

        triggers = {
            sov_national_obligations_treaty_moscow_confirm_button_click_enabled = {
                THIS = {
                    OR = {
                        check_variable = {
                            sov_national_obligations_treaty_moscow_selected_index = 1
                        }
                        check_variable = {
                            sov_national_obligations_treaty_moscow_selected_index = 2
                        }
                    }
                    NOT = {
                        has_country_flag = treaty_moscow_confirmed
                    }
                }
            }

            sov_national_obligations_treaty_moscow_first_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_treaty_moscow_selected_index = 1
                }
            }

            sov_national_obligations_treaty_moscow_first_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = treaty_moscow_confirmed
                    }
                }
            }

            sov_national_obligations_treaty_moscow_second_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_treaty_moscow_selected_index = 2
                }
            }

            sov_national_obligations_treaty_moscow_second_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = treaty_moscow_confirmed
                    }
                }
            }
        }
    }

    #Golden Age
    sov_national_obligations_golden_age_scripted_gui = {
        window_name = "sov_national_obligations_golden_age_view"
        context_type = player_context
        parent_window_name = "sov_national_obligations_scripted_gui_window"

        visible = {
            check_variable = {
                var = sov_national_obligations_selected_index
                value = 9
                compare = equals
            }
        }

        properties = {
            sov_national_obligations_golden_age_first_option_bg = {
                image = [THIS.GetCurrentStatusFirstOptionGoldenAge]
            }

            sov_national_obligations_golden_age_second_option_bg = {
                image = [THIS.GetCurrentStatusSecondOptionGoldenAge]
            }
        }

        effects = {
            sov_national_obligations_golden_age_confirm_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_golden_age_selected_index = 1
                            }
                        }
						set_country_flag = golden_age_random_spirits
                    }
                    else_if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_golden_age_selected_index = 2
                            }
                        }
						every_owned_state = {
							ROOT = { add_state_core = PREV }
						}
                    }
                    set_country_flag = golden_age_confirmed
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations_help
                        }
                        clr_country_flag = sov_open_national_obligations_help
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_debug_national_obligations
                        }
                        clr_country_flag = sov_debug_national_obligations
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations
                        }
                        clr_country_flag = sov_open_national_obligations
                    }
                }
            }

            sov_national_obligations_golden_age_first_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_golden_age_selected_index = 1
                            }
                        }
                        set_variable = {
                            sov_national_obligations_golden_age_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_golden_age_selected_index = 1
                        }
                    }
                }
            }

            sov_national_obligations_golden_age_second_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_golden_age_selected_index = 2
                            }
                        }
                        set_variable = {
                            sov_national_obligations_golden_age_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_golden_age_selected_index = 2
                        }
                    }
                }
            }
        }

        triggers = {
            sov_national_obligations_golden_age_confirm_button_click_enabled = {
                THIS = {
                    OR = {
                        check_variable = {
                            sov_national_obligations_golden_age_selected_index = 1
                        }
                        check_variable = {
                            sov_national_obligations_golden_age_selected_index = 2
                        }
                    }
                    NOT = {
                        has_country_flag = golden_age_confirmed
                    }
                }
            }

            sov_national_obligations_golden_age_first_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_golden_age_selected_index = 1
                }
            }

            sov_national_obligations_golden_age_first_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = golden_age_confirmed
                    }
                }
            }

            sov_national_obligations_golden_age_second_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_golden_age_selected_index = 2
                }
            }

            sov_national_obligations_golden_age_second_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = golden_age_confirmed
                    }
                }
            }
        }
    }

    #Imperial Obligations
   sov_national_obligations_imperial_obligations_scripted_gui = {
        window_name = "sov_national_obligations_imperial_obligations_view"
        context_type = player_context
        parent_window_name = "sov_national_obligations_scripted_gui_window"

        visible = {
            check_variable = {
                var = sov_national_obligations_selected_index
                value = 10
                compare = equals
            }
        }

        properties = {
            sov_national_obligations_imperial_obligations_first_option_bg = {
                image = [THIS.GetCurrentStatusFirstOptionImperialObligations]
            }

            sov_national_obligations_imperial_obligations_second_option_bg = {
                image = [THIS.GetCurrentStatusSecondOptionImperialObligations]
            }

            sov_national_obligations_imperial_obligations_third_option_bg = {
                image = [THIS.GetCurrentStatusThirdOptionImperialObligations]
            }
        }

        effects = {
            sov_national_obligations_imperial_obligations_confirm_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_imperial_obligations_selected_index = 1
                            }
                        }
						#The army will salute him as monarch. . . and assist in making him king. . ."
                        set_country_flag = sov_imperial_obligation_option_1
						division_template = { 
							name = "The Tsar Guard"
							priority = 1
							regiments = {
								infantry = { x = 0 y = 0 }
								infantry = { x = 0 y = 1 }
								infantry = { x = 0 y = 2 }
								infantry = { x = 0 y = 3 }
								infantry = { x = 1 y = 0 }
								infantry = { x = 1 y = 1 }
								infantry = { x = 1 y = 2 }
								infantry = { x = 1 y = 3 }
								infantry = { x = 2 y = 0 }
								infantry = { x = 2 y = 1 }
								infantry = { x = 2 y = 2 }
								infantry = { x = 2 y = 3 }
								infantry = { x = 3 y = 0 }
								infantry = { x = 3 y = 1 }
								infantry = { x = 3 y = 2 }
								infantry = { x = 3 y = 3 }
								infantry = { x = 4 y = 0 }
								infantry = { x = 4 y = 1 }
								infantry = { x = 4 y = 2 }
								infantry = { x = 4 y = 3 }
								artillery = { x = 0 y = 4 }
								artillery = { x = 1 y = 4 }
								artillery = { x = 2 y = 4 }
								artillery = { x = 3 y = 4 }
								artillery = { x = 4 y = 4 }
							}
							support = {
								artillery = { x = 0 y = 0 } 
								engineer = { x = 0 y = 1 }
								recon = { x = 0 y = 2 }
							}
						}
						219 = {
							create_unit = {
								division = "name = \"Nicholas I\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Nicholas II\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Peter I\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Peter II\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Peter III\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Catherine I\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Catherine II\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Alexander I\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Ivan VI\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Anna\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Paul I\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Elizabeth\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Alexander II\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Alexander III\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Alexandra\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Olga\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Tatiana\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Maria\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Anastasia\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Alexei\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Micheal\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Alexis\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Feodor III\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
							create_unit = {
								division = "name = \"Ivan V\" division_template = \"The Tsar Guard\" start_experience_factor = 0.9" 
								owner = SOV
							}
						}
                    }
					if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_imperial_obligations_selected_index = 2
                            }
                        }
						#An absolute monarchy is one in which the sovereign does as he pleases so long as he pleases the assassins - Ambrose Bierce
                       add_ideas = will_of_the_tsar
                    }
					if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_imperial_obligations_selected_index = 3
                            }
                        }
						#As long as there is imperialism in the world, a permanent peace is impossible - Hassan Nasrallah
						SOV = {
							create_faction = imperial_council
							country_event = { id = russia2_russia.677 days = 10 }
						}
						if = {
							limit = {
								ENG = { has_government = neutrality }
							}
							ENG = { country_event = russia2_russia.721 }
						}
						if = {
							limit = {
								FRA = { has_government = neutrality }
							}
							FRA = { country_event = russia2_russia.721 }
						}
						if = {
							limit = {
								SPR = { has_government = neutrality }
							}
							SPR = { country_event = russia2_russia.721 }
						}
						if = {
							limit = {
								SPA = { has_government = neutrality }
							}
							SPA = { country_event = russia2_russia.721 }
						}
						if = {
							limit = {
								HOL = { has_government = neutrality }
							}
							HOL = { country_event = russia2_russia.721 }
						}
						if = {
							limit = {
								BEL = { has_government = neutrality }
							}
							BEL = { country_event = russia2_russia.721 }
						}
						if = {
							limit = {
								LUX = { has_government = neutrality }
							}
							LUX = { country_event = russia2_russia.721 }
						}
						if = {
							limit = {
								NOR = { has_government = neutrality }
							}
							NOR = { country_event = russia2_russia.721 }
						}
						if = {
							limit = {
								SWE = { has_government = neutrality }
							}
							SWE = { country_event = russia2_russia.721 }
						}
						if = {
							limit = {
								FIN = { has_government = neutrality }
							}
							FIN = { country_event = russia2_russia.721 }
						}
						if = {
							limit = {
								DEN = { has_government = neutrality }
							}
							DEN = { country_event = russia2_russia.721 }
						}
						if = {
							limit = {
								ITA = { has_government = neutrality }
							}
							ITA = { country_event = russia2_russia.721 }
						}
						if = {
							limit = {
								YUG = { has_government = neutrality }
							}
							YUG = { country_event = russia2_russia.721 }
						}
						if = {
							limit = {
								ALB = { has_government = neutrality }
							}
							ALB = { country_event = russia2_russia.721 }
						}
						if = {
							limit = {
								BUL = { has_government = neutrality }
							}
							BUL = { country_event = russia2_russia.721 }
						}
						if = {
							limit = {
								GRE = { has_government = neutrality }
							}
							GRE = { country_event = russia2_russia.721 }
						}
						if = {
							limit = {
								POL = { 
									has_government = neutrality
									has_completed_focus = POL_assemble_the_regency_council
								}
							}
							POL = { country_event = russia2_russia.721 }
						}
						if = {
							limit = {
								HUN = { 
									has_government = neutrality
									has_completed_focus = HUN_invite_the_habsburg_prince
								}
							}
							HUN = { country_event = russia2_russia.721 }
						}
						if = {
							limit = {
								GER = { 
									has_government = neutrality
									has_completed_focus = GER_revive_the_kaiserreich
								}
							}
							GER = { country_event = russia2_russia.721 }
						}
						if = {
							limit = {
								POR = { 
									has_government = neutrality
									has_completed_focus = POR_a_royal_wedding
								}
							}
							POR = { country_event = russia2_russia.721 }
						}
                    }
                    set_country_flag = imperial_obligations_confirmed
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations_help
                        }
                        clr_country_flag = sov_open_national_obligations_help
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_debug_national_obligations
                        }
                        clr_country_flag = sov_debug_national_obligations
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations
                        }
                        clr_country_flag = sov_open_national_obligations
                    }
                }
            }

            sov_national_obligations_imperial_obligations_first_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_imperial_obligations_selected_index = 1
                            }
                        }
                        set_variable = {
                            sov_national_obligations_imperial_obligations_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_imperial_obligations_selected_index = 1
                        }
                    }
                }
            }

            sov_national_obligations_imperial_obligations_second_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_imperial_obligations_selected_index = 2
                            }
                        }
                        set_variable = {
                            sov_national_obligations_imperial_obligations_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_imperial_obligations_selected_index = 2
                        }
                    }
                }
            }

            sov_national_obligations_imperial_obligations_third_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_imperial_obligations_selected_index = 3
                            }
                        }
                        set_variable = {
                            sov_national_obligations_imperial_obligations_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_imperial_obligations_selected_index = 3
                        }
                    }
                }
            }
        }

        triggers = {
            sov_national_obligations_imperial_obligations_confirm_button_click_enabled = {
                THIS = {
                    OR = {
                        check_variable = {
                            sov_national_obligations_imperial_obligations_selected_index = 1
                        }
                        check_variable = {
                            sov_national_obligations_imperial_obligations_selected_index = 2
                        }
                        check_variable = {
                            sov_national_obligations_imperial_obligations_selected_index = 3
                        }
                    }
                    NOT = {
                        has_country_flag = imperial_obligations_confirmed
                    }
                }
            }

            sov_national_obligations_imperial_obligations_first_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_imperial_obligations_selected_index = 1
                }
            }

            sov_national_obligations_imperial_obligations_first_option_button_click_enabled = {
                THIS = {
                    OR = {
						has_tech = modern_blitzkrieg
						has_tech = werwolf_guerillas
						has_tech = air_land_battle
						has_tech = shock_and_awe
						has_tech = c3i_theory
						has_tech = infiltration_in_depth
						has_tech = continuous_offensive
						has_tech = guerilla_warfare
					}
                    NOT = {
                        has_country_flag = imperial_obligations_confirmed
                    }
                }
            }

            sov_national_obligations_imperial_obligations_second_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_imperial_obligations_selected_index = 2
                }
            }

            sov_national_obligations_imperial_obligations_second_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = imperial_obligations_confirmed
                    }
                }
            }

            sov_national_obligations_imperial_obligations_third_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_imperial_obligations_selected_index = 3
                }
            }

            sov_national_obligations_imperial_obligations_third_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = imperial_obligations_confirmed
                    }
                }
            }
        }
    }

    #Carry On Legacy
    sov_national_obligations_carry_on_legacy_scripted_gui = {
        window_name = "sov_national_obligations_carry_on_legacy_view"
        context_type = player_context
        parent_window_name = "sov_national_obligations_scripted_gui_window"

        visible = {
            check_variable = {
                var = sov_national_obligations_selected_index
                value = 11
                compare = equals
            }
        }

        properties = {
            sov_national_obligations_carry_on_legacy_first_option_bg = {
                image = [THIS.GetCurrentStatusFirstOptionCarryOnLegacy]
            }

            sov_national_obligations_carry_on_legacy_second_option_bg = {
                image = [THIS.GetCurrentStatusSecondOptionCarryOnLegacy]
            }
        }

        effects = {
            sov_national_obligations_carry_on_legacy_confirm_button_click = {
                THIS = {
                   if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_carry_on_legacy_selected_index = 1
                            }
                        }
						add_ideas = carry_on_the_legacy_idea
                    }
                    else_if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_carry_on_legacy_selected_index = 2
                            }
                        }
						country_event = { id = russia2_russia.712 days = 1 }
                    }
                    set_country_flag = carry_on_legacy_confirmed
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations_help
                        }
                        clr_country_flag = sov_open_national_obligations_help
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_debug_national_obligations
                        }
                        clr_country_flag = sov_debug_national_obligations
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations
                        }
                        clr_country_flag = sov_open_national_obligations
                    }
                }
            }

            sov_national_obligations_carry_on_legacy_first_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_carry_on_legacy_selected_index = 1
                            }
                        }
                        set_variable = {
                            sov_national_obligations_carry_on_legacy_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_carry_on_legacy_selected_index = 1
                        }
                    }
                }
            }

            sov_national_obligations_carry_on_legacy_second_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_carry_on_legacy_selected_index = 2
                            }
                        }
                        set_variable = {
                            sov_national_obligations_carry_on_legacy_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_carry_on_legacy_selected_index = 2
                        }
                    }
                }
            }
        }

        triggers = {
            sov_national_obligations_carry_on_legacy_confirm_button_click_enabled = {
                THIS = {
                    OR = {
                        check_variable = {
                            sov_national_obligations_carry_on_legacy_selected_index = 1
                        }
                        check_variable = {
                            sov_national_obligations_carry_on_legacy_selected_index = 2
                        }
                    }
                    NOT = {
                        has_country_flag = carry_on_legacy_confirmed
                    }
                }
            }

            sov_national_obligations_carry_on_legacy_first_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_carry_on_legacy_selected_index = 1
                }
            }

            sov_national_obligations_carry_on_legacy_first_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = carry_on_legacy_confirmed
                    }
                }
            }

            sov_national_obligations_carry_on_legacy_second_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_carry_on_legacy_selected_index = 2
                }
            }

            sov_national_obligations_carry_on_legacy_second_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = carry_on_legacy_confirmed
                    }
                }
            }
        }
    }

    #Russian Realm
    sov_national_obligations_russian_realm_scripted_gui = {
        window_name = "sov_national_obligations_russian_realm_view"
        context_type = player_context
        parent_window_name = "sov_national_obligations_scripted_gui_window"

        visible = {
            check_variable = {
                var = sov_national_obligations_selected_index
                value = 12
                compare = equals
            }
        }

        properties = {
            sov_national_obligations_russian_realm_first_option_bg = {
                image = [THIS.GetCurrentStatusFirstOptionRussianRealm]
            }

            sov_national_obligations_russian_realm_second_option_bg = {
                image = [THIS.GetCurrentStatusSecondOptionRussianRealm]
            }

            sov_national_obligations_russian_realm_third_option_bg = {
                image = [THIS.GetCurrentStatusThirdOptionRussianRealm]
            }
        }

        effects = {
            sov_national_obligations_russian_realm_confirm_button_click = {
                THIS = {
                     if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_russian_realm_selected_index = 1
                            }
                        }
						set_country_flag = russian_realm_amry_power_double
                    }
                    else_if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_russian_realm_selected_index = 2
                            }
                        }
						set_country_flag = russian_realm_auto_coring
                    }
					else_if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_russian_realm_selected_index = 3
                            }
                        }
                        set_country_flag = russian_realm_blitxkrieg
                    }
                    set_country_flag = russian_realm_confirmed
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations_help
                        }
                        clr_country_flag = sov_open_national_obligations_help
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_debug_national_obligations
                        }
                        clr_country_flag = sov_debug_national_obligations
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations
                        }
                        clr_country_flag = sov_open_national_obligations
                    }
                }
            }

            sov_national_obligations_russian_realm_first_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_russian_realm_selected_index = 1
                            }
                        }
                        set_variable = {
                            sov_national_obligations_russian_realm_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_russian_realm_selected_index = 1
                        }
                    }
                }
            }

            sov_national_obligations_russian_realm_second_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_russian_realm_selected_index = 2
                            }
                        }
                        set_variable = {
                            sov_national_obligations_russian_realm_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_russian_realm_selected_index = 2
                        }
                    }
                }
            }

            sov_national_obligations_russian_realm_third_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_russian_realm_selected_index = 3
                            }
                        }
                        set_variable = {
                            sov_national_obligations_russian_realm_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_russian_realm_selected_index = 3
                        }
                    }
                }
            }
        }

        triggers = {
            sov_national_obligations_russian_realm_confirm_button_click_enabled = {
                THIS = {
                    OR = {
                        check_variable = {
                            sov_national_obligations_russian_realm_selected_index = 1
                        }
                        check_variable = {
                            sov_national_obligations_russian_realm_selected_index = 2
                        }
                        check_variable = {
                            sov_national_obligations_russian_realm_selected_index = 3
                        }
                    }
                    NOT = {
                        has_country_flag = russian_realm_confirmed
                    }
		if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_russian_realm_selected_index = 1
                            }
                        }
                        has_country_flag = unfailing_army_offense_flag
                    }
                }
            }

            sov_national_obligations_russian_realm_first_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_russian_realm_selected_index = 1
                }
            }

            sov_national_obligations_russian_realm_first_option_button_click_enabled = {
                THIS = {
                    has_country_flag = unfailing_army_offense_flag
                    NOT = {
                        has_country_flag = russian_realm_confirmed
                    }
                }
            }

            sov_national_obligations_russian_realm_second_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_russian_realm_selected_index = 2
                }
            }

            sov_national_obligations_russian_realm_second_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = russian_realm_confirmed
                    }
                }
            }

            sov_national_obligations_russian_realm_third_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_russian_realm_selected_index = 3
                }
            }

            sov_national_obligations_russian_realm_third_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = russian_realm_confirmed
                    }
                }
            }
        }
    }

    #Rebirth
  sov_national_obligations_rebirth_scripted_gui = {
        window_name = "sov_national_obligations_rebirth_view"
        context_type = player_context
        parent_window_name = "sov_national_obligations_scripted_gui_window"

        visible = {
            check_variable = {
                var = sov_national_obligations_selected_index
                value = 13
                compare = equals
            }
        }

        properties = {
            sov_national_obligations_rebirth_first_option_bg = {
                image = [THIS.GetCurrentStatusFirstOptionRebirth]
            }

            sov_national_obligations_rebirth_second_option_bg = {
                image = [THIS.GetCurrentStatusSecondOptionRebirth]
            }

            sov_national_obligations_rebirth_third_option_bg = {
                image = [THIS.GetCurrentStatusThirdOptionRebirth]
            }
        }

        effects = {
            sov_national_obligations_rebirth_confirm_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_rebirth_selected_index = 1
                            }
                        }
				if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_rebirth_selected_index = 1
                            }
                        }
                        set_country_flag = sov_rebirth_option_1
						division_template = {
							name = "Free Army"

							regiments = {						
								infantry = { x = 0 y = 0 }
								infantry = { x = 0 y = 1 }
								infantry = { x = 0 y = 2 }
								infantry = { x = 1 y = 0 }
								infantry = { x = 1 y = 1 }
								infantry = { x = 1 y = 2 }
								infantry = { x = 2 y = 0 }
								infantry = { x = 2 y = 1 }
								infantry = { x = 2 y = 2 }
								infantry = { x = 3 y = 0 }
								infantry = { x = 3 y = 1 }
								infantry = { x = 3 y = 2 }
							}
							support = {
								engineer = { x = 0 y = 1 }   
							}
						}
                    }
                    }
                    else_if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_rebirth_selected_index = 2
                            }
                        }
						set_country_flag = rebirth_extinction
						every_controlled_state = {
							ROOT = { add_state_core = PREV }
						}
						
                    }
					else_if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_rebirth_selected_index = 3
                            }
                        }
                        every_possible_country = {
							limit = {
								SOV = {
									has_government = anarchy
								}
							}
							SOV = {
								release = PREV
							}
						}
                    }
                    set_country_flag = rebirth_confirmed
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations_help
                        }
                        clr_country_flag = sov_open_national_obligations_help
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_debug_national_obligations
                        }
                        clr_country_flag = sov_debug_national_obligations
                    }
                    if = {
                        limit = {
                            has_country_flag = sov_open_national_obligations
                        }
                        clr_country_flag = sov_open_national_obligations
                    }
                }
            }

            sov_national_obligations_rebirth_first_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_rebirth_selected_index = 1
                            }
                        }
                        set_variable = {
                            sov_national_obligations_rebirth_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_rebirth_selected_index = 1
                        }
                    }
                }
            }

            sov_national_obligations_rebirth_second_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_rebirth_selected_index = 2
                            }
                        }
                        set_variable = {
                            sov_national_obligations_rebirth_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_rebirth_selected_index = 2
                        }
                    }
                }
            }

            sov_national_obligations_rebirth_third_option_button_click = {
                THIS = {
                    if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_rebirth_selected_index = 3
                            }
                        }
                        set_variable = {
                            sov_national_obligations_rebirth_selected_index = 0
                        }
                    }
                    else = {
                        set_variable = {
                            sov_national_obligations_rebirth_selected_index = 3
                        }
                    }
                }
            }
        }

        triggers = {
            sov_national_obligations_rebirth_confirm_button_click_enabled = {
                THIS = {
                    OR = {
                        check_variable = {
                            sov_national_obligations_rebirth_selected_index = 1
                        }
                        check_variable = {
                            sov_national_obligations_rebirth_selected_index = 2
                        }
                        check_variable = {
                            sov_national_obligations_rebirth_selected_index = 3
                        }
                    }
                    NOT = {
                        has_country_flag = rebirth_confirmed
                    }
					if = {
                        limit = {
                            check_variable = {
                                sov_national_obligations_rebirth_selected_index = 3
                            }
                        }
						all_country = {
							has_government = anarchy
						}
                        #any_other_country = {
						#	exists = yes
						#	NOT = {
						#		OR = {
						#			has_government = fascism
						#			has_government = communism
						#			has_government = democratic
						#			has_government = neutrality
						#		}
						#	}
						#}
                    }
                }
            }

            sov_national_obligations_rebirth_first_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_rebirth_selected_index = 1
                }
            }

            sov_national_obligations_rebirth_first_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = rebirth_confirmed
                    }
                }
            }

            sov_national_obligations_rebirth_second_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_rebirth_selected_index = 2
                }
            }

            sov_national_obligations_rebirth_second_option_button_click_enabled = {
                THIS = {
                    #TODO
                    NOT = {
                        has_country_flag = rebirth_confirmed
                    }
                }
            }

            sov_national_obligations_rebirth_third_option_glow_visible = {
                check_variable = {
                    sov_national_obligations_rebirth_selected_index = 3
                }
            }

            sov_national_obligations_rebirth_third_option_button_click_enabled = {
                THIS = {
					all_country = {
						has_government = anarchy
					}
                    #any_other_country = {
					#	exists = yes
					#	NOT = {
					#	OR = {
					#	has_government = fascism
					#	has_government = communism
					#	has_government = democratic
					#	has_government = neutrality
					#	}
					#	}
					#}
                    NOT = {
                        has_country_flag = rebirth_confirmed
                    }
                }
            }
        }
    }
}
